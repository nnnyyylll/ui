{"version":3,"file":"useQueryIdFromDashboard.js","names":["useQueryIdFromDashboard","dashboardId","sdk","useSDK","DataState","useContainer","getIdFromDashboard","setByDashboardId","queryId","fetcher","dashboard","String","undefined","useSWR","revalidateOnFocus","SWRData","data","isValidating","useEffect","firstTile","ok","value","dashboard_elements","query","id","Number","metadata","isOK","isPending","getErrorResponse"],"sources":["../../../src/hooks/useQueryIdFromDashboard.ts"],"sourcesContent":["/**\n * Copyright (c) 2023 Google LLC\n * SPDX-License-Identifier: MIT\n */\n\nimport { useEffect } from 'react'\nimport type { IDashboard, IError, IQuery } from '@looker/sdk'\nimport type { SDKResponse } from '@looker/sdk-rtl'\nimport useSWR from 'swr'\nimport { getErrorResponse } from '../utils'\nimport { DataState } from './useDataState'\nimport { useSDK } from './useSDK'\n\n/**\n * This hook fetches data from provided dashboard Id, and returns\n * the first query listed in `dashboard_elements` response.\n *\n * @param dashboardId a numeric dashboard Id\n * @returns the query ID associated with the first dashboard tile, and api state\n */\n\nexport const useQueryIdFromDashboard = (dashboardId?: number) => {\n  const sdk = useSDK()\n  const { getIdFromDashboard, setByDashboardId } = DataState.useContainer()\n\n  /*\n   * Check for stored value\n   * -----------------------------------------------------------\n   */\n\n  const queryId = getIdFromDashboard(dashboardId)\n\n  /*\n   * Dispatch network request\n   * -----------------------------------------------------------\n   */\n\n  const fetcher = async () => {\n    if (dashboardId && !queryId) {\n      return await sdk.dashboard(String(dashboardId), 'dashboard_elements')\n    }\n\n    return undefined\n  }\n\n  const { data: SWRData, isValidating } = useSWR<void | SDKResponse<\n    IDashboard,\n    IError\n  >>(\n    `useQueryIdFromDashboard-${dashboardId}`, // caution: argument string must be unique to this instance\n    fetcher,\n    { revalidateOnFocus: false }\n  )\n\n  /*\n   * Publish SWR response to central data store\n   * -----------------------------------------------------------\n   */\n\n  useEffect(() => {\n    const firstTile = SWRData?.ok\n      ? SWRData?.value?.dashboard_elements?.[0]?.query\n      : undefined\n\n    const { id, ...query } = firstTile || ({} as IQuery)\n\n    if (dashboardId && id && Number(id) !== queryId) {\n      setByDashboardId(dashboardId, Number(id), { metadata: query })\n    }\n  }, [SWRData, dashboardId, setByDashboardId, queryId])\n\n  return {\n    isOK: !!queryId || typeof dashboardId === 'undefined',\n    isPending: isValidating,\n    queryId,\n    ...getErrorResponse(SWRData),\n  }\n}\n"],"mappings":";;;;;;;;;;AAKA;AAGA;AACA;AACA;AACA;AAAiC;AAAA;AAAA;;AAU1B,IAAMA,uBAAuB,GAAG,SAA1BA,uBAAuB,CAAIC,WAAoB,EAAK;EAC/D,IAAMC,GAAG,GAAG,IAAAC,cAAM,GAAE;EACpB,4BAAiDC,uBAAS,CAACC,YAAY,EAAE;IAAjEC,kBAAkB,yBAAlBA,kBAAkB;IAAEC,gBAAgB,yBAAhBA,gBAAgB;;EAO5C,IAAMC,OAAO,GAAGF,kBAAkB,CAACL,WAAW,CAAC;;EAO/C,IAAMQ,OAAO;IAAA,sEAAG;MAAA;QAAA;UAAA;YAAA,MACVR,WAAW,IAAI,CAACO,OAAO;cAAA;cAAA;YAAA;YAAA;YAAA,OACZN,GAAG,CAACQ,SAAS,CAACC,MAAM,CAACV,WAAW,CAAC,EAAE,oBAAoB,CAAC;UAAA;YAAA;UAAA;YAAA,iCAGhEW,SAAS;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA,CACjB;IAAA,gBANKH,OAAO;MAAA;IAAA;EAAA,GAMZ;EAED,cAAwC,IAAAI,eAAM,oCAIjBZ,WAAW;IACtCQ,OAAO,EACP;MAAEK,iBAAiB,EAAE;IAAM,CAAC,CAC7B;IAPaC,OAAO,WAAbC,IAAI;IAAWC,YAAY,WAAZA,YAAY;;EAcnC,IAAAC,gBAAS,EAAC,YAAM;IAAA;IACd,IAAMC,SAAS,GAAGJ,OAAO,aAAPA,OAAO,eAAPA,OAAO,CAAEK,EAAE,GACzBL,OAAO,aAAPA,OAAO,yCAAPA,OAAO,CAAEM,KAAK,4EAAd,eAAgBC,kBAAkB,oFAAlC,sBAAqC,CAAC,CAAC,2DAAvC,uBAAyCC,KAAK,GAC9CX,SAAS;IAEb,YAAyBO,SAAS,IAAK,CAAC,CAAY;MAA5CK,EAAE,SAAFA,EAAE;MAAKD,KAAK;IAEpB,IAAItB,WAAW,IAAIuB,EAAE,IAAIC,MAAM,CAACD,EAAE,CAAC,KAAKhB,OAAO,EAAE;MAC/CD,gBAAgB,CAACN,WAAW,EAAEwB,MAAM,CAACD,EAAE,CAAC,EAAE;QAAEE,QAAQ,EAAEH;MAAM,CAAC,CAAC;IAChE;EACF,CAAC,EAAE,CAACR,OAAO,EAAEd,WAAW,EAAEM,gBAAgB,EAAEC,OAAO,CAAC,CAAC;EAErD;IACEmB,IAAI,EAAE,CAAC,CAACnB,OAAO,IAAI,OAAOP,WAAW,KAAK,WAAW;IACrD2B,SAAS,EAAEX,YAAY;IACvBT,OAAO,EAAPA;EAAO,GACJ,IAAAqB,uBAAgB,EAACd,OAAO,CAAC;AAEhC,CAAC;AAAA"}